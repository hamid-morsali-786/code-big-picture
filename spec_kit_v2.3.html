<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Big Picture V2.2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #fcfcfc;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --accent: #3b82f6;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            padding: 8px 16px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h1 { margin: 0; font-size: 1.1rem; font-weight: 800; color: var(--text-primary); }
        .badge { font-size: 0.65rem; background: var(--accent); color: white; padding: 3px 8px; border-radius: 12px; font-weight: 600; }

        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        #search-input {
            background: rgba(0,0,0,0.04);
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            padding-left: 36px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            width: 200px;
            outline: none;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            opacity: 0.4;
        }

        #viewport { width: 100vw; height: 100vh; cursor: grab; }
        .box-rect { transition: all 0.3s ease; }
        
        .node { transition: opacity 0.3s ease; }
        .node.dimmed { opacity: 0.15; filter: grayscale(100%); }
        .node.highlighted > .box-rect {
            stroke: var(--accent) !important;
            stroke-width: 3;
            filter: drop-shadow(0 0 15px rgba(59, 130, 246, 0.4));
        }

        .box-rect {
            transition: height 0.3s ease, stroke-width 0.3s ease;
        }

        .node-content {
            transition: opacity 0.3s ease;
        }

        .controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: white;
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* Legend Style */
        .legend {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 12px 18px;
            border-radius: 16px;
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
        }
        
        .legend-title {
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #64748b;
            margin-bottom: 4px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 11px;
            font-weight: 600;
            color: #475569;
        }
        
        .legend-icon {
            width: 14px;
            height: 14px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <svg style="display:none">
        <!-- Project: Full isometric cube -->
        <symbol id="cube" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
            <line x1="12" y1="22.08" x2="12" y2="12"></line>
        </symbol>
        <!-- Package: Stacked layers (Hierarchy) -->
        <symbol id="package" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
            <polyline points="2 17 12 22 22 17"></polyline>
            <polyline points="2 12 12 17 22 12"></polyline>
        </symbol>
        <!-- Folder: Directory container -->
        <symbol id="folder" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </symbol>
        <!-- Python Module: File with code tags -->
        <symbol id="file-code" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <path d="m10 13-2 2 2 2"></path><path d="m14 17 2-2-2-2"></path>
        </symbol>
        <!-- Class: Structured box (Blueprint) -->
        <symbol id="box" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
            <circle cx="12" cy="12" r="3" fill="currentColor" opacity="0.4"></circle>
        </symbol>
        <!-- Logic icons unchanged -->
        <symbol id="terminal" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></symbol>
        <symbol id="file-text" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></symbol>
        <symbol id="alert-circle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></symbol>
    </svg>

    <header>
        <div class="brand">
            <h1>Code Big Picture</h1>
            <div class="badge">V2.3</div>
        </div>
        
        <div class="search-container">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" id="search-input" placeholder="Search modules, classes..." autocomplete="off">
        </div>
    </header>

    <div id="viewport">
        <svg id="main-svg" width="100%" height="100%">
            <g id="scene">
                
        <g class="node" id="node-e70053b0">
            
        <rect class="box-rect" width="1219.0" height="1272" stroke="#1a1a1b" fill="#ffffff" rx="6" ry="6" data-full-h="1272" />
        <use href="#cube" x="8" y="8" width="16" height="16" stroke="#1a1a1b" />
        <text x="30" y="20" fill="#1a1a1b" style="font-weight: 700; font-size: 13px;">
            spec-kit-main
            <title>spec-kit-main</title>
        </text>
        
            <g class="toggle-btn" onclick="toggleNode('node-e70053b0')" style="cursor: pointer; opacity: 0.6;">
                <circle cx="1204.0" cy="15" r="7" fill="white" stroke="#1a1a1b" stroke-width="1"/>
                <text x="1204.0" y="19" text-anchor="middle" font-size="10" font-weight="bold" fill="#1a1a1b" style="pointer-events: none;">-</text>
            </g>
            
        
            <g id="content-node-e70053b0" class="node-content" transform="translate(0, 5)">
                <g transform="translate(15, 35)" data-y="35">
        <rect class="box-rect" width="120" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            AGENTS.md
            <title>AGENTS.md</title>
        </text>
        
        </g><g transform="translate(145, 35)" data-y="35">
        <rect class="box-rect" width="142.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            CHANGELOG.md
            <title>CHANGELOG.md</title>
        </text>
        
        </g><g transform="translate(297.0, 35)" data-y="35">
        <rect class="box-rect" width="193.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            CODE_OF_CONDUCT.md
            <title>CODE_OF_CONDUCT.md</title>
        </text>
        
        </g><g transform="translate(500.0, 35)" data-y="35">
        <rect class="box-rect" width="167.5" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            CONTRIBUTING.md
            <title>CONTRIBUTING.md</title>
        </text>
        
        </g><g transform="translate(15, 87)" data-y="87">
        <g class="node" id="node-fc754093">
            
        <rect class="box-rect" width="682.5" height="144" stroke="#adb5bd" fill="#ffffff" rx="6" ry="6" data-full-h="144" />
        <use href="#folder" x="8" y="8" width="16" height="16" stroke="#adb5bd" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            docs
            <title>docs</title>
        </text>
        
            <g class="toggle-btn" onclick="toggleNode('node-fc754093')" style="cursor: pointer; opacity: 0.6;">
                <circle cx="667.5" cy="15" r="7" fill="white" stroke="#adb5bd" stroke-width="1"/>
                <text x="667.5" y="19" text-anchor="middle" font-size="10" font-weight="bold" fill="#adb5bd" style="pointer-events: none;">-</text>
            </g>
            
        
            <g id="content-node-fc754093" class="node-content" transform="translate(0, 5)">
                <g transform="translate(15, 35)" data-y="35">
        <rect class="box-rect" width="125.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            docfx.json
            <title>docfx.json</title>
        </text>
        
        </g><g transform="translate(150.0, 35)" data-y="35">
        <rect class="box-rect" width="120" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            index.md
            <title>index.md</title>
        </text>
        
        </g><g transform="translate(280.0, 35)" data-y="35">
        <rect class="box-rect" width="167.5" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            installation.md
            <title>installation.md</title>
        </text>
        
        </g><g transform="translate(457.5, 35)" data-y="35">
        <rect class="box-rect" width="210.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            local-development.md
            <title>local-development.md</title>
        </text>
        
        </g><g transform="translate(15, 87)" data-y="87">
        <rect class="box-rect" width="150.5" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            quickstart.md
            <title>quickstart.md</title>
        </text>
        
        </g><g transform="translate(175.5, 87)" data-y="87">
        <rect class="box-rect" width="120" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            README.md
            <title>README.md</title>
        </text>
        
        </g><g transform="translate(305.5, 87)" data-y="87">
        <rect class="box-rect" width="120" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            toc.yml
            <title>toc.yml</title>
        </text>
        
        </g><g transform="translate(435.5, 87)" data-y="87">
        <rect class="box-rect" width="125.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            upgrade.md
            <title>upgrade.md</title>
        </text>
        
        </g>
            </g>
        </g>
        </g><g transform="translate(707.5, 87)" data-y="87">
        <g class="node" id="node-407f6aa6">
            
        <rect class="box-rect" width="197.5" height="92" stroke="#adb5bd" fill="#ffffff" rx="6" ry="6" data-full-h="92" />
        <use href="#folder" x="8" y="8" width="16" height="16" stroke="#adb5bd" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            memory
            <title>memory</title>
        </text>
        
            <g class="toggle-btn" onclick="toggleNode('node-407f6aa6')" style="cursor: pointer; opacity: 0.6;">
                <circle cx="182.5" cy="15" r="7" fill="white" stroke="#adb5bd" stroke-width="1"/>
                <text x="182.5" y="19" text-anchor="middle" font-size="10" font-weight="bold" fill="#adb5bd" style="pointer-events: none;">-</text>
            </g>
            
        
            <g id="content-node-407f6aa6" class="node-content" transform="translate(0, 5)">
                <g transform="translate(15, 35)" data-y="35">
        <rect class="box-rect" width="167.5" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            constitution.md
            <title>constitution.md</title>
        </text>
        
        </g>
            </g>
        </g>
        </g><g transform="translate(915.0, 87)" data-y="87">
        <rect class="box-rect" width="159.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            pyproject.toml
            <title>pyproject.toml</title>
        </text>
        
        </g><g transform="translate(1084.0, 87)" data-y="87">
        <rect class="box-rect" width="120" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            README.md
            <title>README.md</title>
        </text>
        
        </g><g transform="translate(15, 241)" data-y="241">
        <rect class="box-rect" width="133.5" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            SECURITY.md
            <title>SECURITY.md</title>
        </text>
        
        </g><g transform="translate(158.5, 241)" data-y="241">
        <rect class="box-rect" width="159.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            spec-driven.md
            <title>spec-driven.md</title>
        </text>
        
        </g><g transform="translate(327.5, 241)" data-y="241">
        <g class="node" id="node-e884cb7e">
            
        <rect class="box-rect" width="860.0" height="708" stroke="#adb5bd" fill="#ffffff" rx="6" ry="6" data-full-h="708" />
        <use href="#folder" x="8" y="8" width="16" height="16" stroke="#adb5bd" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            src
            <title>src</title>
        </text>
        
            <g class="toggle-btn" onclick="toggleNode('node-e884cb7e')" style="cursor: pointer; opacity: 0.6;">
                <circle cx="845.0" cy="15" r="7" fill="white" stroke="#adb5bd" stroke-width="1"/>
                <text x="845.0" y="19" text-anchor="middle" font-size="10" font-weight="bold" fill="#adb5bd" style="pointer-events: none;">-</text>
            </g>
            
        
            <g id="content-node-e884cb7e" class="node-content" transform="translate(0, 5)">
                <g transform="translate(15, 35)" data-y="35">
        <g class="node" id="node-6d07a7e1">
            
        <rect class="box-rect" width="830.0" height="658" stroke="#495057" fill="#f8f9fa" rx="6" ry="6" data-full-h="658" />
        <use href="#package" x="8" y="8" width="16" height="16" stroke="#495057" />
        <text x="30" y="20" fill="#212529" style="font-weight: 700; font-size: 13px;">
            specify_cli
            <title>specify_cli</title>
        </text>
        
            <g class="toggle-btn" onclick="toggleNode('node-6d07a7e1')" style="cursor: pointer; opacity: 0.6;">
                <circle cx="815.0" cy="15" r="7" fill="white" stroke="#495057" stroke-width="1"/>
                <text x="815.0" y="19" text-anchor="middle" font-size="10" font-weight="bold" fill="#495057" style="pointer-events: none;">-</text>
            </g>
            
        
            <g id="content-node-6d07a7e1" class="node-content" transform="translate(0, 5)">
                <g transform="translate(15, 35)" data-y="35">
        <g class="node" id="node-568b64d6">
            
        <rect class="box-rect" width="800.0" height="608" stroke="#1971c2" fill="#e7f5ff" rx="6" ry="6" data-full-h="608" />
        <use href="#file-code" x="8" y="8" width="16" height="16" stroke="#1971c2" />
        <text x="30" y="20" fill="#1864ab" style="font-weight: 700; font-size: 13px;">
            __init__.py
            <title>__init__.py</title>
        </text>
        
            <g class="toggle-btn" onclick="toggleNode('node-568b64d6')" style="cursor: pointer; opacity: 0.6;">
                <circle cx="785.0" cy="15" r="7" fill="white" stroke="#1971c2" stroke-width="1"/>
                <text x="785.0" y="19" text-anchor="middle" font-size="10" font-weight="bold" fill="#1971c2" style="pointer-events: none;">-</text>
            </g>
            
        
            <g id="content-node-568b64d6" class="node-content" transform="translate(0, 5)">
                <g transform="translate(15, 35)" data-y="35">
        <rect class="box-rect" width="150.5" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            _github_token
            <title>_github_token</title>
        </text>
        
        </g><g transform="translate(175.5, 35)" data-y="35">
        <rect class="box-rect" width="210.0" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            _github_auth_headers
            <title>_github_auth_headers</title>
        </text>
        
        </g><g transform="translate(395.5, 35)" data-y="35">
        <rect class="box-rect" width="252.5" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            _parse_rate_limit_headers
            <title>_parse_rate_limit_headers</title>
        </text>
        
        </g><g transform="translate(15, 87)" data-y="87">
        <rect class="box-rect" width="244.0" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            _format_rate_limit_error
            <title>_format_rate_limit_error</title>
        </text>
        
        </g><g transform="translate(15, 139)" data-y="139">
        <g class="node" id="node-52d227e4">
            
        <rect class="box-rect" width="709.0" height="144" stroke="#6741d9" fill="#f3f0ff" rx="6" ry="6" data-full-h="144" />
        <use href="#box" x="8" y="8" width="16" height="16" stroke="#6741d9" />
        <text x="30" y="20" fill="#5f3dc4" style="font-weight: 700; font-size: 13px;">
            StepTracker
            <title>StepTracker</title>
        </text>
        
            <g class="toggle-btn" onclick="toggleNode('node-52d227e4')" style="cursor: pointer; opacity: 0.6;">
                <circle cx="694.0" cy="15" r="7" fill="white" stroke="#6741d9" stroke-width="1"/>
                <text x="694.0" y="19" text-anchor="middle" font-size="10" font-weight="bold" fill="#6741d9" style="pointer-events: none;">-</text>
            </g>
            
        
            <g id="content-node-52d227e4" class="node-content" transform="translate(0, 5)">
                <g transform="translate(15, 35)" data-y="35">
        <rect class="box-rect" width="120" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            __init__
            <title>__init__</title>
        </text>
        
        </g><g transform="translate(145, 35)" data-y="35">
        <rect class="box-rect" width="159.0" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            attach_refresh
            <title>attach_refresh</title>
        </text>
        
        </g><g transform="translate(314.0, 35)" data-y="35">
        <rect class="box-rect" width="120" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            add
            <title>add</title>
        </text>
        
        </g><g transform="translate(444.0, 35)" data-y="35">
        <rect class="box-rect" width="120" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            start
            <title>start</title>
        </text>
        
        </g><g transform="translate(574.0, 35)" data-y="35">
        <rect class="box-rect" width="120" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            complete
            <title>complete</title>
        </text>
        
        </g><g transform="translate(15, 87)" data-y="87">
        <rect class="box-rect" width="120" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            error
            <title>error</title>
        </text>
        
        </g><g transform="translate(145, 87)" data-y="87">
        <rect class="box-rect" width="120" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            skip
            <title>skip</title>
        </text>
        
        </g><g transform="translate(275, 87)" data-y="87">
        <rect class="box-rect" width="120" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            _update
            <title>_update</title>
        </text>
        
        </g><g transform="translate(405, 87)" data-y="87">
        <rect class="box-rect" width="159.0" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            _maybe_refresh
            <title>_maybe_refresh</title>
        </text>
        
        </g><g transform="translate(574.0, 87)" data-y="87">
        <rect class="box-rect" width="120" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            render
            <title>render</title>
        </text>
        
        </g>
            </g>
        </g>
        </g><g transform="translate(15, 293)" data-y="293">
        <rect class="box-rect" width="120" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            get_key
            <title>get_key</title>
        </text>
        
        </g><g transform="translate(145, 293)" data-y="293">
        <rect class="box-rect" width="193.0" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            select_with_arrows
            <title>select_with_arrows</title>
        </text>
        
        </g><g transform="translate(348.0, 293)" data-y="293">
        <g class="node" id="node-4f48615d">
            
        <rect class="box-rect" width="163.5" height="92" stroke="#6741d9" fill="#f3f0ff" rx="6" ry="6" data-full-h="92" />
        <use href="#box" x="8" y="8" width="16" height="16" stroke="#6741d9" />
        <text x="30" y="20" fill="#5f3dc4" style="font-weight: 700; font-size: 13px;">
            BannerGroup
            <title>BannerGroup</title>
        </text>
        
            <g class="toggle-btn" onclick="toggleNode('node-4f48615d')" style="cursor: pointer; opacity: 0.6;">
                <circle cx="148.5" cy="15" r="7" fill="white" stroke="#6741d9" stroke-width="1"/>
                <text x="148.5" y="19" text-anchor="middle" font-size="10" font-weight="bold" fill="#6741d9" style="pointer-events: none;">-</text>
            </g>
            
        
            <g id="content-node-4f48615d" class="node-content" transform="translate(0, 5)">
                <g transform="translate(15, 35)" data-y="35">
        <rect class="box-rect" width="133.5" height="42" stroke="#c2255c" fill="#fff0f6" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#c2255c" />
        <text x="30" y="20" fill="#a61e4d" style="font-weight: 700; font-size: 13px;">
            format_help
            <title>format_help</title>
        </text>
        
        </g>
            </g>
        </g>
        </g><g transform="translate(521.5, 293)" data-y="293">
        <rect class="box-rect" width="133.5" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            show_banner
            <title>show_banner</title>
        </text>
        
        </g><g transform="translate(665.0, 293)" data-y="293">
        <rect class="box-rect" width="120" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            callback
            <title>callback</title>
        </text>
        
        </g><g transform="translate(15, 395)" data-y="395">
        <rect class="box-rect" width="133.5" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            run_command
            <title>run_command</title>
        </text>
        
        </g><g transform="translate(158.5, 395)" data-y="395">
        <rect class="box-rect" width="125.0" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            check_tool
            <title>check_tool</title>
        </text>
        
        </g><g transform="translate(293.5, 395)" data-y="395">
        <rect class="box-rect" width="133.5" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            is_git_repo
            <title>is_git_repo</title>
        </text>
        
        </g><g transform="translate(437.0, 395)" data-y="395">
        <rect class="box-rect" width="150.5" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            init_git_repo
            <title>init_git_repo</title>
        </text>
        
        </g><g transform="translate(15, 447)" data-y="447">
        <rect class="box-rect" width="227.0" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            handle_vscode_settings
            <title>handle_vscode_settings</title>
        </text>
        
        </g><g transform="translate(252.0, 447)" data-y="447">
        <rect class="box-rect" width="176.0" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            merge_json_files
            <title>merge_json_files</title>
        </text>
        
        </g><g transform="translate(438.0, 447)" data-y="447">
        <rect class="box-rect" width="286.5" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            download_template_from_github
            <title>download_template_from_github</title>
        </text>
        
        </g><g transform="translate(15, 499)" data-y="499">
        <rect class="box-rect" width="286.5" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            download_and_extract_template
            <title>download_and_extract_template</title>
        </text>
        
        </g><g transform="translate(311.5, 499)" data-y="499">
        <rect class="box-rect" width="252.5" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            ensure_executable_scripts
            <title>ensure_executable_scripts</title>
        </text>
        
        </g><g transform="translate(574.0, 499)" data-y="499">
        <rect class="box-rect" width="120" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            init
            <title>init</title>
        </text>
        
        </g><g transform="translate(15, 551)" data-y="551">
        <rect class="box-rect" width="120" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            check
            <title>check</title>
        </text>
        
        </g><g transform="translate(145, 551)" data-y="551">
        <rect class="box-rect" width="120" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            version
            <title>version</title>
        </text>
        
        </g><g transform="translate(275, 551)" data-y="551">
        <rect class="box-rect" width="120" height="42" stroke="#f08c00" fill="#fff9db" rx="6" ry="6" data-full-h="42" />
        <use href="#terminal" x="8" y="8" width="16" height="16" stroke="#f08c00" />
        <text x="30" y="20" fill="#e67700" style="font-weight: 700; font-size: 13px;">
            main
            <title>main</title>
        </text>
        
        </g>
            </g>
        </g>
        </g>
            </g>
        </g>
        </g>
            </g>
        </g>
        </g><g transform="translate(15, 959)" data-y="959">
        <rect class="box-rect" width="125.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            SUPPORT.md
            <title>SUPPORT.md</title>
        </text>
        
        </g><g transform="translate(150.0, 959)" data-y="959">
        <g class="node" id="node-b8555e31">
            
        <rect class="box-rect" width="806.5" height="298" stroke="#adb5bd" fill="#ffffff" rx="6" ry="6" data-full-h="298" />
        <use href="#folder" x="8" y="8" width="16" height="16" stroke="#adb5bd" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            templates
            <title>templates</title>
        </text>
        
            <g class="toggle-btn" onclick="toggleNode('node-b8555e31')" style="cursor: pointer; opacity: 0.6;">
                <circle cx="791.5" cy="15" r="7" fill="white" stroke="#adb5bd" stroke-width="1"/>
                <text x="791.5" y="19" text-anchor="middle" font-size="10" font-weight="bold" fill="#adb5bd" style="pointer-events: none;">-</text>
            </g>
            
        
            <g id="content-node-b8555e31" class="node-content" transform="translate(0, 5)">
                <g transform="translate(15, 35)" data-y="35">
        <rect class="box-rect" width="227.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            agent-file-template.md
            <title>agent-file-template.md</title>
        </text>
        
        </g><g transform="translate(252.0, 35)" data-y="35">
        <rect class="box-rect" width="218.5" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            checklist-template.md
            <title>checklist-template.md</title>
        </text>
        
        </g><g transform="translate(15, 87)" data-y="87">
        <g class="node" id="node-b6ffc7c8">
            
        <rect class="box-rect" width="771.5" height="144" stroke="#adb5bd" fill="#ffffff" rx="6" ry="6" data-full-h="144" />
        <use href="#folder" x="8" y="8" width="16" height="16" stroke="#adb5bd" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            commands
            <title>commands</title>
        </text>
        
            <g class="toggle-btn" onclick="toggleNode('node-b6ffc7c8')" style="cursor: pointer; opacity: 0.6;">
                <circle cx="756.5" cy="15" r="7" fill="white" stroke="#adb5bd" stroke-width="1"/>
                <text x="756.5" y="19" text-anchor="middle" font-size="10" font-weight="bold" fill="#adb5bd" style="pointer-events: none;">-</text>
            </g>
            
        
            <g id="content-node-b6ffc7c8" class="node-content" transform="translate(0, 5)">
                <g transform="translate(15, 35)" data-y="35">
        <rect class="box-rect" width="125.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            analyze.md
            <title>analyze.md</title>
        </text>
        
        </g><g transform="translate(150.0, 35)" data-y="35">
        <rect class="box-rect" width="142.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            checklist.md
            <title>checklist.md</title>
        </text>
        
        </g><g transform="translate(302.0, 35)" data-y="35">
        <rect class="box-rect" width="125.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            clarify.md
            <title>clarify.md</title>
        </text>
        
        </g><g transform="translate(437.0, 35)" data-y="35">
        <rect class="box-rect" width="167.5" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            constitution.md
            <title>constitution.md</title>
        </text>
        
        </g><g transform="translate(614.5, 35)" data-y="35">
        <rect class="box-rect" width="142.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            implement.md
            <title>implement.md</title>
        </text>
        
        </g><g transform="translate(15, 87)" data-y="87">
        <rect class="box-rect" width="120" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            plan.md
            <title>plan.md</title>
        </text>
        
        </g><g transform="translate(145, 87)" data-y="87">
        <rect class="box-rect" width="125.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            specify.md
            <title>specify.md</title>
        </text>
        
        </g><g transform="translate(280.0, 87)" data-y="87">
        <rect class="box-rect" width="120" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            tasks.md
            <title>tasks.md</title>
        </text>
        
        </g><g transform="translate(410.0, 87)" data-y="87">
        <rect class="box-rect" width="176.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            taskstoissues.md
            <title>taskstoissues.md</title>
        </text>
        
        </g>
            </g>
        </g>
        </g><g transform="translate(15, 241)" data-y="241">
        <rect class="box-rect" width="176.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            plan-template.md
            <title>plan-template.md</title>
        </text>
        
        </g><g transform="translate(201.0, 241)" data-y="241">
        <rect class="box-rect" width="176.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            spec-template.md
            <title>spec-template.md</title>
        </text>
        
        </g><g transform="translate(387.0, 241)" data-y="241">
        <rect class="box-rect" width="184.5" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            tasks-template.md
            <title>tasks-template.md</title>
        </text>
        
        </g><g transform="translate(581.5, 241)" data-y="241">
        <rect class="box-rect" width="210.0" height="42" stroke="#868e96" fill="#f1f3f5" rx="6" ry="6" data-full-h="42" />
        <use href="#file-text" x="8" y="8" width="16" height="16" stroke="#868e96" />
        <text x="30" y="20" fill="#495057" style="font-weight: 700; font-size: 13px;">
            vscode-settings.json
            <title>vscode-settings.json</title>
        </text>
        
        </g>
            </g>
        </g>
        </g>
            </g>
        </g>
        
            </g>
        </svg>
    </div>

    <div class="legend" id="map-legend">
        <div class="legend-title">Map Guide / راهنما</div>
        <div class="legend-item"><svg class="legend-icon"><use href="#cube" /></svg> Project</div>
        <div class="legend-item"><svg class="legend-icon"><use href="#package" /></svg> Package</div>
        <div class="legend-item"><svg class="legend-icon"><use href="#folder" /></svg> Directory</div>
        <div class="legend-item"><svg class="legend-icon"><use href="#file-code" /></svg> Python Module</div>
        <div class="legend-item"><svg class="legend-icon"><use href="#box" /></svg> Class</div>
        <div class="legend-item"><svg class="legend-icon"><use href="#terminal" /></svg> Function / Method</div>
        <div class="legend-item"><svg class="legend-icon"><use href="#file-text" /></svg> Other File</div>
    </div>

    <div class="controls">
        <button class="btn" onclick="zoom(1.2)" title="Zoom In">+</button>
        <button class="btn" onclick="zoom(0.8)" title="Zoom Out">-</button>
        <button class="btn" onclick="resetView()" title="Fit to Screen">⟲</button>
    </div>

    <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
    <script>
        const elem = document.getElementById('scene');
        const svg = document.getElementById('main-svg');
        const searchInput = document.getElementById('search-input');
        
        const panzoom = Panzoom(elem, {
            maxScale: 20,
            minScale: 0.01,
            contain: false
        });
        
        const parent = elem.parentElement;
        parent.addEventListener('wheel', panzoom.zoomWithWheel);

        function zoom(scale) {
            panzoom.zoom(panzoom.getScale() * scale, { animate: true });
        }

        function resetView() {
            fitToScreen();
            searchInput.value = '';
            performSearch('');
        }
        
        function fitToScreen() {
            const bbox = elem.getBBox();
            const parentWidth = parent.clientWidth;
            const parentHeight = parent.clientHeight;
            
            const scaleX = (parentWidth - 100) / bbox.width;
            const scaleY = (parentHeight - 100) / bbox.height;
            const scale = Math.min(scaleX, scaleY);
            
            const x = (parentWidth - bbox.width * scale) / 2 - bbox.x * scale;
            const y = (parentHeight - bbox.height * scale) / 2 - bbox.y * scale;
            
            panzoom.zoom(scale);
            panzoom.pan(x / scale, y / scale);
            
            setTimeout(() => {
                 panzoom.zoom(scale);
                 panzoom.pan(x / scale, y / scale);
            }, 10);
        }

        // Search Logic
        function performSearch(query) {
            const term = query.toLowerCase().trim();
            const nodes = document.querySelectorAll('.node');
            
            if (!term) {
                nodes.forEach(node => {
                    node.classList.remove('dimmed', 'highlighted');
                });
                return;
            }

            // 1. Reset all
            nodes.forEach(node => node.classList.add('dimmed'));
            nodes.forEach(node => node.classList.remove('highlighted'));

            // 2. Find matches
            const matchedNodes = [];
            nodes.forEach(node => {
                // We store the name in a data attribute for easier access, 
                // but let's grab the text element content for now
                const textEl = node.querySelector('text');
                if (textEl && textEl.textContent.toLowerCase().includes(term)) {
                    matchedNodes.push(node);
                    node.classList.remove('dimmed');
                    node.classList.add('highlighted');
                }
            });
            
            // 3. Reveal parents of matches
            matchedNodes.forEach(node => {
                let parent = node.parentElement; 
                while (parent) {
                     if (parent.classList && parent.classList.contains('node')) {
                         parent.classList.remove('dimmed');
                         // Auto expand parents if collapsed? (future enhancement)
                     }
                     parent = parent.parentElement;
                     if (parent.id === 'scene') break;
                }
            });
        }

        function getTranslateY(el) {
            const transform = el.getAttribute('transform') || '';
            const match = /translate\([^,]+,\s*([^)]+)\)/.exec(transform);
            return match ? parseFloat(match[1]) : 0;
        }

        function setTranslateY(el, y) {
            const transform = el.getAttribute('transform') || '';
            // Handle translate(x, y)
            const newTransform = transform.replace(/(translate\([^,]+,)\s*[^)]+\)/, `$1 ${y})`);
            el.setAttribute('transform', newTransform);
            el.setAttribute('data-y', y);
        }

        // Collapse/Expand Logic with Smart Reflow
        window.toggleNode = function(nodeId) {
            const nodeG = document.getElementById(nodeId);
            const content = document.getElementById('content-' + nodeId);
            const rect = nodeG.querySelector('.box-rect');
            const btnText = nodeG.querySelector('.toggle-btn text');
            const headerH = 35; 
            const fullH = parseFloat(rect.getAttribute('data-full-h'));
            
            const isExpanding = (content.style.display === 'none');
            const deltaH = isExpanding ? (fullH - headerH) : (headerH - fullH);

            if (isExpanding) {
                content.style.display = 'block';
                btnText.textContent = '-';
                rect.setAttribute('height', fullH);
                nodeG.classList.remove('collapsed');
            } else {
                content.style.display = 'none';
                btnText.textContent = '+';
                rect.setAttribute('height', headerH);
                nodeG.classList.add('collapsed');
            }

            propagateReflow(nodeG, deltaH);
        };

        function propagateReflow(nodeG, deltaH) {
            // 1. Shift siblings below this node
            const wrapper = nodeG.parentElement; // The <g transform>
            const container = wrapper.parentElement; // The content-<id> group
            
            if (container && container.classList.contains('node-content')) {
                const targetY = parseFloat(wrapper.getAttribute('data-y') || 0);
                const siblings = container.children;
                for (let sib of siblings) {
                    if (sib === wrapper) continue;
                    const sibY = parseFloat(sib.getAttribute('data-y') || 0);
                    if (sibY > targetY) {
                        setTranslateY(sib, sibY + deltaH);
                    }
                }
                
                // 2. Shrink parent and recurse
                const parentNodeG = container.parentElement;
                if (parentNodeG && parentNodeG.classList.contains('node')) {
                    const parentRect = parentNodeG.querySelector('.box-rect');
                    const currentH = parseFloat(parentRect.getAttribute('height'));
                    const newH = currentH + deltaH;
                    parentRect.setAttribute('height', newH);
                    
                    propagateReflow(parentNodeG, deltaH);
                }
            }
        }

        searchInput.addEventListener('input', (e) => {
            performSearch(e.target.value);
        });
        
        // Disable PanZoom when typing in search
        searchInput.addEventListener('focus', () => {
             // panzoom.pause() // Not widely supported in v4 default?
             // Actually it's fine, wheel event is on parent div.
        });

        window.addEventListener('load', () => {
             setTimeout(() => {
                fitToScreen();
             }, 100);
        });
    </script>
</body>
</html>
